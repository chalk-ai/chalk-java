#!/bin/bash

set -e  # Exit immediately on error

# Ensure a version argument is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <version>"
  exit 1
fi

# Remove leading 'v' if present
VERSION="${1#v}"

BRANCH_NAME="release/$VERSION"

# Create a new branch
git checkout -b "$BRANCH_NAME"

# Update README.md and gradle.properties
sed -i "s|implementation 'ai.chalk:chalk-java:[0-9.]*'|implementation 'ai.chalk:chalk-java:$VERSION'|" README.md
sed -i "s|<version>[0-9.]*</version>|<version>$VERSION</version>|" README.md
sed -i "s/^version=.*/version=$VERSION/" gradle.properties

# Commit and push changes
git add README.md gradle.properties
git commit -m "[generated] Release version $VERSION"
git push origin "$BRANCH_NAME"

# Create a pull request
gh pr create --base main --head "$BRANCH_NAME" --title "[generated] Release $VERSION" --body "PR generated by create-release-pr.sh"
